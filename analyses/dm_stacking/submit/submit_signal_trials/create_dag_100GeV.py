#!/usr/bin/env python3

import numpy as np
import os
#USER = os.getenv('USER')

#ana = 'NorthernTracks_v005p01_KDE_PDF_v009_seyfert_model'
#base_path = '/data/ana/analyses/'

njobs_per_ns = 50
ntrials = 20
ncpu =  4
#period  = "IC86_2011-IC86_2021"

outdir = "/data/user/liruohan/dm_model_stacking/trials/"

mean_ns_fit = np.asarray([  1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,
        13,  14,  15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,
        26,  27,  28,  29,  30,  31,  32,  33,  34,  35,  36,  37,  38,
        39,  40,  41,  42,  43,  44,  45,  46,  47,  48,  49,  50,  51,
        52,  53,  54,  55,  56,  57,  58,  59,  60,  61,  62,  63,  64,
        65,  66,  67,  68,  69,  70,  71,  72,  73,  74,  75,  76,  77,
        78,  79,  80,  81,  82,  83,  84,  85,  86,  87,  88,  89,  90,
        91,  92,  93,  94,  95,  96,  97,  98,  99, 100, 101, 102, 103,
       104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116,
       117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
       130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142,
       143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155,
       156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168,
       169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181,
       182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194,
       195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207,
       208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220,
       221, 222, 223, 224, 225, 226, 227, 228, 229, 230, 231, 232, 233,
       234, 235, 236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246,
       247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
       260, 261, 262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272,
       273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285,
       286, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 298,
       299, 300])
mean_ns_inj = np.asarray([ 643.,  647.,  652.,  656.,  661.,  665.,  669.,  674.,
        678.,  683.,  687.,  691.,  696.,  700.,  705.,  709.,  714.,
        718.,  722.,  727.,  731.,  736.,  740.,  744.,  749.,  753.,
        758.,  762.,  766.,  771.,  775.,  780.,  784.,  788.,  793.,
        797.,  802.,  806.,  810.,  815.,  819.,  824.,  828.,  833.,
        837.,  841.,  846.,  850.,  855.,  859.,  863.,  868.,  872.,
        877.,  881.,  885.,  890.,  894.,  899.,  903.,  907.,  912.,
        916.,  921.,  925.,  929.,  934.,  938.,  943.,  947.,  952.,
        956.,  960.,  965.,  969.,  974.,  978.,  982.,  987.,  991.,
        996., 1000., 1004., 1009., 1013., 1018., 1022., 1026., 1031.,
       1035., 1040., 1044., 1048., 1053., 1057., 1062., 1066., 1071.,
       1075., 1079., 1084., 1088., 1093., 1097., 1101., 1106., 1110.,
       1115., 1119., 1123., 1128., 1132., 1137., 1141., 1145., 1150.,
       1154., 1159., 1163., 1167., 1172., 1176., 1181., 1185., 1190.,
       1194., 1198., 1203., 1207., 1212., 1216., 1220., 1225., 1229.,
       1234., 1238., 1242., 1247., 1251., 1256., 1260., 1264., 1269.,
       1273., 1278., 1282., 1286., 1291., 1295., 1300., 1304., 1309.,
       1313., 1317., 1322., 1326., 1331., 1335., 1339., 1344., 1348.,
       1353., 1357., 1361., 1366., 1370., 1375., 1379., 1383., 1388.,
       1392., 1397., 1401., 1405., 1410., 1414., 1419., 1423., 1428.,
       1432., 1436., 1441., 1445., 1450., 1454., 1458., 1463., 1467.,
       1472., 1476., 1480., 1485., 1489., 1494., 1498., 1502., 1507.,
       1511., 1516., 1520., 1524., 1529., 1533., 1538., 1542., 1546.,
       1551., 1555., 1560., 1564., 1569., 1573., 1577., 1582., 1586.,
       1591., 1595., 1599., 1604., 1608., 1613., 1617., 1621., 1626.,
       1630., 1635., 1639., 1643., 1648., 1652., 1657., 1661., 1665.,
       1670., 1674., 1679., 1683., 1688., 1692., 1696., 1701., 1705.,
       1710., 1714., 1718., 1723., 1727., 1732., 1736., 1740., 1745.,
       1749., 1754., 1758., 1762., 1767., 1771., 1776., 1780., 1784.,
       1789., 1793., 1798., 1802., 1807., 1811., 1815., 1820., 1824.,
       1829., 1833., 1837., 1842., 1846., 1851., 1855., 1859., 1864.,
       1868., 1873., 1877., 1881., 1886., 1890., 1895., 1899., 1903.,
       1908., 1912., 1917., 1921., 1926., 1930., 1934., 1939., 1943.,
       1948., 1952., 1956., 1961.])

#split into 15 groups each 20

for i in range (0,15):
    file_num = str(i+1).zfill(2)
    dag_file_name="trials_{}.dag".format(file_num)
    with open(dag_file_name, "w") as fout:
        rss_seed = 0
        start_idx=i*20
        end_idx=i*20+20
        for j,tns in enumerate(mean_ns_inj[start_idx:end_idx]):
            for job_id in range(njobs_per_ns):
                rss_seed += 1
                tjob = "job_"+str(rss_seed) 
    
                outfile = 'mean_ns_inj{}_mean_ns_fit{}_trials{}_rss{:}.npy'.format(tns, mean_ns_fit[j+start_idx], ntrials, rss_seed)
    
                fout.write("JOB %s trials.submit\n" %(tjob))
                fout.write("VARS %s OUTDIR=\"%s\" OFILE=\"%s\" NTRIALS=\"%s\" MEANNS=\"%s\" RSS_SEED=\"%s\" CPU=\"%s\"\n" %(tjob, outdir, outfile, str(ntrials), str(tns), str(rss_seed), ncpu)) 
    

# with open("trials_16.dag", "w") as fout:
#     rss_seed = 0
#     tns=mean_ns_inj[-1]
#     for job_id in range(njobs_per_ns):
#         rss_seed += 1
#         tjob = "job_"+str(rss_seed) 

#         outfile = 'mean_ns_inj{}_mean_ns_fit{}_trials{}_rss{:}.npy'.format(tns, mean_ns_fit[-1], ntrials, rss_seed)

#         fout.write("JOB %s trials.submit\n" %(tjob))
#         fout.write("VARS %s OUTDIR=\"%s\" OFILE=\"%s\" NTRIALS=\"%s\" MEANNS=\"%s\" RSS_SEED=\"%s\" CPU=\"%s\"\n" %(tjob, outdir, outfile, str(ntrials), str(tns), str(rss_seed), ncpu)) 
